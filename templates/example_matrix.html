<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Example Matrix - MovieLens Recommender</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body>
    <nav class="navbar navbar-expand-lg">
        <div class="container">
            <a class="navbar-brand" href="/">
                <i class="fas fa-film me-2"></i>MovieLens Recommender
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="/"><i class="fas fa-home me-1"></i> Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/user_recommendations"><i class="fas fa-user me-1"></i> User Recommendations</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/compare_algorithms"><i class="fas fa-chart-bar me-1"></i> Algorithm Comparison</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="/example_matrix"><i class="fas fa-table me-1"></i> Example Matrix</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container mt-5">
        <div class="row">
            <div class="col-lg-12">
                <div class="page-title">
                    <h2><i class="fas fa-table me-2"></i>Example Matrix Completion</h2>
                    <p class="lead">Demonstration of the algorithm on the project's example matrix</p>
                </div>
            </div>
        </div>

        <div class="row mt-4">
            <div class="col-lg-5">
                <div class="content-card">
                    <h3>Project Matrix Example</h3>
                    <p>This is the example matrix from the project document:</p>
                    
                    <div class="matrix-example">
                        <table class="table table-bordered">
                            <thead>
                                <tr>
                                    <th></th>
                                    <th>HP1</th>
                                    <th>HP2</th>
                                    <th>HP3</th>
                                    <th>TW</th>
                                    <th>SW1</th>
                                    <th>SW2</th>
                                    <th>SW3</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <th>A</th>
                                    <td>4</td>
                                    <td></td>
                                    <td>5</td>
                                    <td></td>
                                    <td>1</td>
                                    <td></td>
                                    <td></td>
                                </tr>
                                <tr>
                                    <th>B</th>
                                    <td>5</td>
                                    <td>5</td>
                                    <td>4</td>
                                    <td>2</td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                </tr>
                                <tr>
                                    <th>C</th>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td>4</td>
                                    <td>5</td>
                                    <td>3</td>
                                </tr>
                                <tr>
                                    <th>D</th>
                                    <td></td>
                                    <td>3</td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td>3</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="alert alert-info mt-3">
                        <strong>Goal:</strong> Fill in the missing values using recommendation algorithms.
                    </div>
                    
                    <button id="runExampleBtn" class="btn btn-primary mt-2">
                        <i class="fas fa-play me-2"></i>Fill Missing Values
                    </button>
                </div>
                
                <div class="content-card mt-4">
                    <h3>Algorithm Details</h3>
                    <p>The Global Baseline approach combines:</p>
                    <ul>
                        <li><strong>Global Mean (μ):</strong> Average rating across all users and items</li>
                        <li><strong>User Bias (b<sub>u</sub>):</strong> How much each user tends to rate above/below average</li>
                        <li><strong>Item Bias (b<sub>i</sub>):</strong> How much each item tends to be rated above/below average</li>
                    </ul>
                    <p>The prediction formula is: r̂<sub>ui</sub> = μ + b<sub>u</sub> + b<sub>i</sub></p>
                </div>
            </div>
            
            <div class="col-lg-7">
                <div id="loadingExample" class="text-center d-none">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                    <p class="mt-2">Processing example matrix...</p>
                </div>
                
                <div id="matrixResult" class="d-none">
                    <div class="content-card">
                        <h3>Completed Matrix</h3>
                        <p>Matrix with missing values filled in using the Global Baseline approach:</p>
                        
                        <div class="table-responsive">
                            <table class="table table-bordered completed-matrix">
                                <thead id="completedMatrixHead">
                                    <!-- Header will be inserted here -->
                                </thead>
                                <tbody id="completedMatrixBody">
                                    <!-- Rows will be inserted here -->
                                </tbody>
                            </table>
                        </div>
                        
                        <div class="legend mt-3">
                            <span class="original-value">4.00</span> Original values
                            <span class="predicted-value ms-3">3.67</span> Predicted values
                        </div>
                    </div>
                    
                    <div class="content-card mt-4">
                        <h3>Visualization</h3>
                        <div id="matrixHeatmap" class="chart-container"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer class="mt-5 py-4">
        <div class="container text-center">
            <p>© 2025 MovieLens Recommender System · Big Data Project</p>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        $(document).ready(function() {
            // Handle button click
            $('#runExampleBtn').on('click', function() {
                // Show loading spinner
                $('#matrixResult').addClass('d-none');
                $('#loadingExample').removeClass('d-none');
                
                // Send request to server
                $.ajax({
                    url: '/run_example',
                    type: 'POST',
                    success: function(response) {
                        // Hide loading spinner
                        $('#loadingExample').addClass('d-none');
                        
                        // Build completed matrix table
                        const completedMatrixHead = $('#completedMatrixHead');
                        const completedMatrixBody = $('#completedMatrixBody');
                        
                        completedMatrixHead.empty();
                        completedMatrixBody.empty();
                        
                        // Get all items
                        const items = [];
                        for (const user in response.filledMatrix) {
                            for (const item in response.filledMatrix[user]) {
                                if (!items.includes(item)) {
                                    items.push(item);
                                }
                            }
                        }
                        
                        // Sort items
                        items.sort();
                        
                        // Create header
                        let headerRow = '<tr><th></th>';
                        items.forEach(item => {
                            headerRow += `<th>${item}</th>`;
                        });
                        headerRow += '</tr>';
                        completedMatrixHead.append(headerRow);
                        
                        // Create rows
                        for (const user in response.filledMatrix) {
                            let row = `<tr><th>${user}</th>`;
                            
                            items.forEach(item => {
                                const value = response.filledMatrix[user][item];
                                const originalValue = response.originalMatrix[user] && response.originalMatrix[user][item] ? 
                                                     response.originalMatrix[user][item] : '';
                                                     
                                if (originalValue !== '') {
                                    // Original value
                                    row += `<td class="original-value">${originalValue}</td>`;
                                } else if (value) {
                                    // Predicted value
                                    row += `<td class="predicted-value">${value}</td>`;
                                } else {
                                    // Empty cell
                                    row += `<td></td>`;
                                }
                            });
                            
                            row += '</tr>';
                            completedMatrixBody.append(row);
                        }
                        
                        // Display heatmap
                        const chartJson = JSON.parse(response.chartJson);
                        Plotly.newPlot('matrixHeatmap', chartJson.data, chartJson.layout);
                        
                        // Show results
                        $('#matrixResult').removeClass('d-none');
                    },
                    error: function() {
                        // Hide loading spinner
                        $('#loadingExample').addClass('d-none');
                        alert('An error occurred. Please try again.');
                    }
                });
            });
        });
    </script>
</body>
</html>
