<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Algorithm Comparison - RecommendPro</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <nav class="navbar navbar-expand-lg">
        <div class="container">
            <a class="navbar-brand" href="/">
                <i class="fas fa-film me-2"></i>RecommendPro
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="/"><i class="fas fa-home me-1"></i> Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/user_recommendations"><i class="fas fa-user me-1"></i> Recommendations</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="/compare_algorithms"><i class="fas fa-chart-bar me-1"></i> Algorithm Compare</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/example_matrix"><i class="fas fa-table me-1"></i> Matrix Demo</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container mt-5">
        <div class="row">
            <div class="col-lg-12">
                <div class="page-title">
                    <h2><i class="fas fa-chart-bar me-2"></i>Algorithm Performance Comparison</h2>
                    <p class="lead">Compare recommendation algorithms to select the optimal solution for your business needs</p>
                </div>
            </div>
        </div>

        <div class="row mt-4">
            <div class="col-lg-4">
                <div class="card comparison-form">
                    <div class="card-body">
                        <h3 class="card-title">Test Configuration</h3>
                        <form id="comparisonForm">
                            <div class="mb-4">
                                <label for="testSize" class="form-label">Number of Test Users</label>
                                <input type="range" class="form-range" id="testSize" name="testSize" min="5" max="20" value="10">
                                <div class="d-flex justify-content-between">
                                    <span>5 users</span>
                                    <span id="testSizeValue">10 users</span>
                                    <span>20 users</span>
                                </div>
                            </div>
                            <div class="mb-4">
                                <label for="testRatio" class="form-label">Test Ratio (% of ratings to hide)</label>
                                <input type="range" class="form-range" id="testRatio" name="testRatio" min="0.1" max="0.5" step="0.05" value="0.2">
                                <div class="d-flex justify-content-between">
                                    <span>10%</span>
                                    <span id="testRatioValue">20%</span>
                                    <span>50%</span>
                                </div>
                            </div>
                            
                            <div class="mb-4">
                                <label class="form-label">Algorithm Selection</label>
                                <div class="algorithm-selector">
                                    <div class="form-check form-check-inline">
                                        <input class="form-check-input" type="checkbox" id="algoUserUser" name="algorithms[]" value="user_user" checked>
                                        <label class="form-check-label" for="algoUserUser">User-User CF</label>
                                    </div>
                                    <div class="form-check form-check-inline">
                                        <input class="form-check-input" type="checkbox" id="algoItemItem" name="algorithms[]" value="item_item" checked>
                                        <label class="form-check-label" for="algoItemItem">Item-Item CF</label>
                                    </div>
                                    <div class="form-check form-check-inline">
                                        <input class="form-check-input" type="checkbox" id="algoBaseline" name="algorithms[]" value="baseline" checked>
                                        <label class="form-check-label" for="algoBaseline">Global Baseline</label>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="alert alert-info">
                                <i class="fas fa-info-circle me-2"></i> The test will run selected algorithms against real user data to measure accuracy (RMSE).
                            </div>
                            <button type="submit" class="btn btn-primary w-100">Run Performance Test</button>
                        </form>
                    </div>
                </div>
                
                <div class="card mt-4 d-none" id="resultsCard">
                    <div class="card-body">
                        <h3 class="card-title">Performance Results</h3>
                        <div class="table-responsive">
                            <table class="table table-bordered results-table">
                                <thead>
                                    <tr>
                                        <th>Algorithm</th>
                                        <th>RMSE <i class="fas fa-arrow-down text-success" title="Lower is better"></i></th>
                                        <th>Test Samples</th>
                                    </tr>
                                </thead>
                                <tbody id="resultsTable">
                                    <!-- Results will be inserted here -->
                                </tbody>
                            </table>
                        </div>
                        <div class="alert alert-success mt-3 best-algorithm">
                            <i class="fas fa-trophy me-2"></i> Recommended Algorithm: <span id="bestAlgorithm"></span>
                            <p class="mt-2 mb-0" id="recommendationReason"></p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-8">
                <div id="loadingComparison" class="text-center d-none">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                    <p class="mt-2">Running algorithm benchmark tests...</p>
                    <p class="text-muted">This may take a few moments depending on the dataset size and test parameters.</p>
                </div>
                
                <div id="comparisonExplanation">
                    <div class="content-card">
                        <h3><i class="fas fa-rocket me-2"></i>Enterprise Algorithm Selection</h3>
                        <p class="lead">Choose the right algorithm based on your specific business requirements</p>
                        
                        <div class="row mt-4">
                            <div class="col-md-6">
                                <div class="card h-100">
                                    <div class="card-body">
                                        <h4><i class="fas fa-users text-primary me-2"></i>User-User CF</h4>
                                        <p><strong>Best for:</strong> Communities with social connections</p>
                                        <ul>
                                            <li>Discovers unexpected recommendations</li>
                                            <li>Ideal for diverse product catalogs</li>
                                            <li>Better for new items than new users</li>
                                        </ul>
                                        <hr>
                                        <div class="d-flex justify-content-between">
                                            <span><i class="fas fa-bolt"></i> Performance</span>
                                            <div class="progress w-50">
                                                <div class="progress-bar" role="progressbar" style="width: 60%" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100"></div>
                                            </div>
                                        </div>
                                        <div class="d-flex justify-content-between mt-2">
                                            <span><i class="fas fa-bullseye"></i> Accuracy</span>
                                            <div class="progress w-50">
                                                <div class="progress-bar bg-success" role="progressbar" style="width: 80%" aria-valuenow="80" aria-valuemin="0" aria-valuemax="100"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card h-100">
                                    <div class="card-body">
                                        <h4><i class="fas fa-film text-primary me-2"></i>Item-Item CF</h4>
                                        <p><strong>Best for:</strong> Large catalogs and cross-selling</p>
                                        <ul>
                                            <li>Excellent for "similar item" recommendations</li>
                                            <li>More scalable for large inventories</li>
                                            <li>Better prediction accuracy for most cases</li>
                                        </ul>
                                        <hr>
                                        <div class="d-flex justify-content-between">
                                            <span><i class="fas fa-bolt"></i> Performance</span>
                                            <div class="progress w-50">
                                                <div class="progress-bar" role="progressbar" style="width: 75%" aria-valuenow="75" aria-valuemin="0" aria-valuemax="100"></div>
                                            </div>
                                        </div>
                                        <div class="d-flex justify-content-between mt-2">
                                            <span><i class="fas fa-bullseye"></i> Accuracy</span>
                                            <div class="progress w-50">
                                                <div class="progress-bar bg-success" role="progressbar" style="width: 90%" aria-valuenow="90" aria-valuemin="0" aria-valuemax="100"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row mt-3">
                            <div class="col-md-6">
                                <div class="card h-100">
                                    <div class="card-body">
                                        <h4><i class="fas fa-chart-line text-primary me-2"></i>Global Baseline</h4>
                                        <p><strong>Best for:</strong> New deployments and cold starts</p>
                                        <ul>
                                            <li>Fastest execution time</li>
                                            <li>Works well with sparse data</li>
                                            <li>Provides a solid foundation for hybrid approaches</li>
                                        </ul>
                                        <hr>
                                        <div class="d-flex justify-content-between">
                                            <span><i class="fas fa-bolt"></i> Performance</span>
                                            <div class="progress w-50">
                                                <div class="progress-bar" role="progressbar" style="width: 95%" aria-valuenow="95" aria-valuemin="0" aria-valuemax="100"></div>
                                            </div>
                                        </div>
                                        <div class="d-flex justify-content-between mt-2">
                                            <span><i class="fas fa-bullseye"></i> Accuracy</span>
                                            <div class="progress w-50">
                                                <div class="progress-bar bg-success" role="progressbar" style="width: 70%" aria-valuenow="70" aria-valuemin="0" aria-valuemax="100"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card h-100">
                                    <div class="card-body">
                                        <h4><i class="fas fa-info-circle text-primary me-2"></i>Understanding RMSE</h4>
                                        <p>Root Mean Square Error measures prediction accuracy:</p>
                                        <ul>
                                            <li><strong>Lower RMSE</strong>: Better prediction accuracy</li>
                                            <li><strong>Context matters</strong>: A difference of 0.1 can be significant</li>
                                            <li><strong>Real-world impact</strong>: Lower RMSE typically means more relevant recommendations</li>
                                        </ul>
                                        <div class="alert alert-light mt-2">
                                            <small>The benchmark test splits user ratings into training and test sets, then measures how accurately each algorithm predicts the hidden ratings.</small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="alert alert-primary mt-4">
                            <i class="fas fa-lightbulb me-2"></i> <strong>Pro Tip:</strong> The optimal algorithm often depends on your specific use case. Run these tests against your own data for the most accurate results.
                        </div>
                    </div>
                </div>
                
                <div id="textResults" class="d-none">
                    <div class="content-card">
                        <h3 class="mb-4">Performance Analysis</h3>
                        <div id="algorithmComparison" class="mb-4">
                            <!-- Algorithm comparison text will be inserted here -->
                        </div>
                        
                        <h4 class="mb-3">Key Metrics</h4>
                        <div class="row">
                            <div class="col-md-4">
                                <div class="card bg-light">
                                    <div class="card-body text-center">
                                        <h5 class="card-title">Accuracy</h5>
                                        <i class="fas fa-bullseye fa-2x text-primary mb-3"></i>
                                        <h2 id="accuracyScore">--</h2>
                                        <p class="text-muted mb-0">Lower RMSE = Better</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="card bg-light">
                                    <div class="card-body text-center">
                                        <h5 class="card-title">Test Coverage</h5>
                                        <i class="fas fa-percentage fa-2x text-primary mb-3"></i>
                                        <h2 id="coverageScore">--</h2>
                                        <p class="text-muted mb-0">% of test set</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="card bg-light">
                                    <div class="card-body text-center">
                                        <h5 class="card-title">Relative Gain</h5>
                                        <i class="fas fa-arrow-up fa-2x text-primary mb-3"></i>
                                        <h2 id="relativeGain">--</h2>
                                        <p class="text-muted mb-0">vs. baseline</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer class="mt-5 py-4">
        <div class="container">
            <div class="footer-brand">
                <i class="fas fa-film me-2"></i> RecommendPro © 2025
            </div>
            <div class="footer-links">
                <a href="#">About</a>
                <a href="#">Features</a>
                <a href="#">Documentation</a>
                <a href="#">Contact</a>
            </div>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        $(document).ready(function() {
            // Update displayed values for range inputs
            $('#testSize').on('input', function() {
                $('#testSizeValue').text($(this).val() + ' users');
            });
            
            $('#testRatio').on('input', function() {
                const ratio = parseFloat($(this).val()) * 100;
                $('#testRatioValue').text(ratio + '%');
            });
            
            // Handle form submission
            $('#comparisonForm').on('submit', function(e) {
                e.preventDefault();
                
                // Ensure at least one algorithm is selected
                if ($('input[name="algorithms[]"]:checked').length === 0) {
                    alert('Please select at least one algorithm to test');
                    return;
                }
                
                // Get form values
                const testSize = $('#testSize').val();
                const testRatio = $('#testRatio').val();
                const algorithms = [];
                
                $('input[name="algorithms[]"]:checked').each(function() {
                    algorithms.push($(this).val());
                });
                
                // Show loading spinner
                $('#comparisonExplanation').addClass('d-none');
                $('#textResults').addClass('d-none');
                $('#resultsCard').addClass('d-none');
                $('#loadingComparison').removeClass('d-none');
                
                // Send request to server
                $.ajax({
                    url: '/run_comparison',
                    type: 'POST',
                    data: {
                        testSize: testSize,
                        testRatio: testRatio,
                        algorithms: JSON.stringify(algorithms)
                    },
                    success: function(response) {
                        // Hide loading spinner
                        $('#loadingComparison').addClass('d-none');
                        
                        // Display results table
                        const resultsTable = $('#resultsTable');
                        resultsTable.empty();
                        
                        const results = response.results;
                        let bestRmse = Infinity;
                        let bestAlgorithm = '';
                        let bestAlgorithmName = '';
                        
                        for (const [algorithm, data] of Object.entries(results)) {
                            const algorithmName = algorithm === 'user_user' ? 'User-User CF' : 
                                                (algorithm === 'item_item' ? 'Item-Item CF' : 'Global Baseline');
                            
                            resultsTable.append(`
                                <tr>
                                    <td>${algorithmName}</td>
                                    <td>${data.rmse.toFixed(4)}</td>
                                    <td>${data.count}</td>
                                </tr>
                            `);
                            
                            if (data.rmse < bestRmse) {
                                bestRmse = data.rmse;
                                bestAlgorithm = algorithm;
                                bestAlgorithmName = algorithmName;
                            }
                        }
                        
                        $('#bestAlgorithm').text(bestAlgorithmName);
                        $('#resultsCard').removeClass('d-none');
                        
                        // Generate recommendation reason
                        let reason = '';
                        if (bestAlgorithm === 'user_user') {
                            reason = 'Provides the best balance of personalization and accuracy for your data.';
                        } else if (bestAlgorithm === 'item_item') {
                            reason = 'Excellent for product similarity recommendations, with the highest accuracy on your data.';
                        } else {
                            reason = 'Offers the best performance with balanced accuracy for your data scenario.';
                        }
                        $('#recommendationReason').text(reason);
                        
                        // Display text results
                        const algorithmComparison = $('#algorithmComparison');
                        algorithmComparison.empty();
                        
                        // Create comparison text
                        const sortedAlgorithms = Object.entries(results).sort((a, b) => a[1].rmse - b[1].rmse);
                        
                        let comparisonHtml = `<p>Based on the test with ${testSize} users and ${parseFloat(testRatio) * 100}% held-out ratings:</p>`;
                        comparisonHtml += `<ul>`;
                        
                        sortedAlgorithms.forEach(([algo, data], index) => {
                            const algoName = algo === 'user_user' ? 'User-User CF' : 
                                           (algo === 'item_item' ? 'Item-Item CF' : 'Global Baseline');
                            
                            let rankText = '';
                            if (index === 0) {
                                rankText = '<span class="badge bg-success">Best</span>';
                            } else {
                                const percentWorse = (((data.rmse - bestRmse) / bestRmse) * 100).toFixed(1);
                                rankText = `<span class="text-muted">(${percentWorse}% lower accuracy)</span>`;
                            }
                            
                            comparisonHtml += `<li><strong>${algoName}</strong>: RMSE of ${data.rmse.toFixed(4)} ${rankText}</li>`;
                        });
                        
                        comparisonHtml += `</ul>`;
                        algorithmComparison.html(comparisonHtml);
                        
                        // Update metrics
                        $('#accuracyScore').text(bestRmse.toFixed(3));
                        
                        // Calculate coverage
                        const bestAlgoData = results[bestAlgorithm];
                        const coverage = Math.round((bestAlgoData.count / (testSize * parseInt(testRatio * 10))) * 100);
                        $('#coverageScore').text(coverage + '%');
                        
                        // Calculate relative gain over baseline
                        if (results.hasOwnProperty('baseline') && bestAlgorithm !== 'baseline') {
                            const baselineRmse = results['baseline'].rmse;
                            const improvement = ((baselineRmse - bestRmse) / baselineRmse * 100).toFixed(1);
                            $('#relativeGain').text(improvement + '%');
                        } else {
                            $('#relativeGain').text('N/A');
                        }
                        
                        // Show text results
                        $('#textResults').removeClass('d-none');
                    },
                    error: function() {
                        // Hide loading spinner
                        $('#loadingComparison').addClass('d-none');
                        alert('An error occurred during the comparison. Please try again.');
                        $('#comparisonExplanation').removeClass('d-none');
                    }
                });
            });
        });
    </script>
</body>
</html>
