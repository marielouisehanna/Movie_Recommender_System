<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Algorithm Comparison - MovieLens Recommender</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body>
    <nav class="navbar navbar-expand-lg">
        <div class="container">
            <a class="navbar-brand" href="/">
                <i class="fas fa-film me-2"></i>MovieLens Recommender
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="/"><i class="fas fa-home me-1"></i> Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/user_recommendations"><i class="fas fa-user me-1"></i> User Recommendations</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="/compare_algorithms"><i class="fas fa-chart-bar me-1"></i> Algorithm Comparison</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/example_matrix"><i class="fas fa-table me-1"></i> Example Matrix</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container mt-5">
        <div class="row">
            <div class="col-lg-12">
                <div class="page-title">
                    <h2><i class="fas fa-chart-bar me-2"></i>Algorithm Comparison</h2>
                    <p class="lead">Compare the performance of different recommendation algorithms</p>
                </div>
            </div>
        </div>

        <div class="row mt-4">
            <div class="col-lg-4">
                <div class="card comparison-form">
                    <div class="card-body">
                        <h3 class="card-title">Test Parameters</h3>
                        <form id="comparisonForm">
                            <div class="mb-3">
                                <label for="testSize" class="form-label">Number of Test Users</label>
                                <input type="range" class="form-range" id="testSize" name="testSize" min="5" max="20" value="10">
                                <div class="d-flex justify-content-between">
                                    <span>5 users</span>
                                    <span id="testSizeValue">10 users</span>
                                    <span>20 users</span>
                                </div>
                            </div>
                            <div class="mb-3">
                                <label for="testRatio" class="form-label">Test Ratio (% of ratings to hide)</label>
                                <input type="range" class="form-range" id="testRatio" name="testRatio" min="0.1" max="0.5" step="0.05" value="0.2">
                                <div class="d-flex justify-content-between">
                                    <span>10%</span>
                                    <span id="testRatioValue">20%</span>
                                    <span>50%</span>
                                </div>
                            </div>
                            <div class="alert alert-info">
                                <i class="fas fa-info-circle me-2"></i> The comparison will test all three algorithms: User-User CF, Item-Item CF, and Global Baseline.
                            </div>
                            <button type="submit" class="btn btn-primary w-100">Run Comparison</button>
                        </form>
                    </div>
                </div>
                
                <div class="card mt-4 d-none" id="resultsCard">
                    <div class="card-body">
                        <h3 class="card-title">RMSE Results</h3>
                        <div class="table-responsive">
                            <table class="table table-bordered">
                                <thead>
                                    <tr>
                                        <th>Algorithm</th>
                                        <th>RMSE</th>
                                        <th>Samples</th>
                                    </tr>
                                </thead>
                                <tbody id="resultsTable">
                                    <!-- Results will be inserted here -->
                                </tbody>
                            </table>
                        </div>
                        <div class="alert alert-success mt-3">
                            <i class="fas fa-trophy me-2"></i> Best Algorithm: <span id="bestAlgorithm"></span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-8">
                <div id="loadingComparison" class="text-center d-none">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                    <p class="mt-2">Running algorithm comparison...</p>
                    <p class="text-muted">This may take a few moments depending on the dataset size.</p>
                </div>
                
                <div id="comparisonChart" class="chart-container d-none">
                    <!-- Plotly chart will be inserted here -->
                </div>
                
                <div id="comparisonExplanation" class="mt-4 d-none">
                    <div class="content-card">
                        <h4>Understanding RMSE</h4>
                        <p>Root Mean Square Error (RMSE) measures the accuracy of predictions - the lower the RMSE value, the better the algorithm is performing.</p>
                        
                        <h4 class="mt-3">Algorithm Comparison</h4>
                        <ul class="algorithm-comparison">
                            <li><strong>User-User CF:</strong> Finds similar users and recommends what they liked</li>
                            <li><strong>Item-Item CF:</strong> Finds similar items to ones you've already rated highly</li>
                            <li><strong>Global Baseline:</strong> Uses global averages, user bias, and item popularity</li>
                        </ul>
                        
                        <div class="alert alert-light mt-3">
                            <p><strong>Note:</strong> The performance of these algorithms can vary depending on:</p>
                            <ul>
                                <li>Data sparsity (how many ratings are available)</li>
                                <li>Number of users and items in the dataset</li>
                                <li>Rating distribution and user behavior patterns</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer class="mt-5 py-4">
        <div class="container text-center">
            <p>© 2025 MovieLens Recommender System · Big Data Project</p>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        $(document).ready(function() {
            // Update displayed values for range inputs
            $('#testSize').on('input', function() {
                $('#testSizeValue').text($(this).val() + ' users');
            });
            
            $('#testRatio').on('input', function() {
                const ratio = parseFloat($(this).val()) * 100;
                $('#testRatioValue').text(ratio + '%');
            });
            
            // Handle form submission
            $('#comparisonForm').on('submit', function(e) {
                e.preventDefault();
                
                // Get form values
                const testSize = $('#testSize').val();
                const testRatio = $('#testRatio').val();
                
                // Show loading spinner
                $('#comparisonChart').addClass('d-none');
                $('#comparisonExplanation').addClass('d-none');
                $('#resultsCard').addClass('d-none');
                $('#loadingComparison').removeClass('d-none');
                
                // Send request to server
                $.ajax({
                    url: '/run_comparison',
                    type: 'POST',
                    data: {
                        testSize: testSize,
                        testRatio: testRatio
                    },
                    success: function(response) {
                        // Hide loading spinner
                        $('#loadingComparison').addClass('d-none');
                        
                        // Display results table
                        const resultsTable = $('#resultsTable');
                        resultsTable.empty();
                        
                        const results = response.results;
                        let bestRmse = Infinity;
                        let bestAlgorithm = '';
                        
                        for (const [algorithm, data] of Object.entries(results)) {
                            const algorithmName = algorithm === 'user_user' ? 'User-User CF' : 
                                                (algorithm === 'item_item' ? 'Item-Item CF' : 'Global Baseline');
                            
                            resultsTable.append(`
                                <tr>
                                    <td>${algorithmName}</td>
                                    <td>${data.rmse.toFixed(4)}</td>
                                    <td>${data.count}</td>
                                </tr>
                            `);
                            
                            if (data.rmse < bestRmse) {
                                bestRmse = data.rmse;
                                bestAlgorithm = algorithmName;
                            }
                        }
                        
                        $('#bestAlgorithm').text(bestAlgorithm);
                        $('#resultsCard').removeClass('d-none');
                        
                        // Display chart
                        const chartJson = JSON.parse(response.chartJson);
                        Plotly.newPlot('comparisonChart', chartJson.data, chartJson.layout);
                        $('#comparisonChart').removeClass('d-none');
                        
                        // Show explanation
                        $('#comparisonExplanation').removeClass('d-none');
                    },
                    error: function() {
                        // Hide loading spinner
                        $('#loadingComparison').addClass('d-none');
                        alert('An error occurred during the comparison. Please try again.');
                    }
                });
            });
        });
    </script>
</body>
</html>
