<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Recommendations - MovieLens Recommender</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <nav class="navbar navbar-expand-lg">
        <div class="container">
            <a class="navbar-brand" href="/">
                <i class="fas fa-film me-2"></i>MovieLens Recommender
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="/"><i class="fas fa-home me-1"></i> Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="/user_recommendations"><i class="fas fa-user me-1"></i> User Recommendations</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/compare_algorithms"><i class="fas fa-chart-bar me-1"></i> Algorithm Comparison</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/example_matrix"><i class="fas fa-table me-1"></i> Example Matrix</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container mt-5">
        <div class="row">
            <div class="col-lg-12">
                <div class="page-title">
                    <h2><i class="fas fa-user me-2"></i>User Recommendations</h2>
                    <p class="lead">Get personalized movie recommendations for any user</p>
                </div>
            </div>
        </div>

        <div class="row mt-4">
            <div class="col-lg-4">
                <div class="card recommendation-form">
                    <div class="card-body">
                        <h3 class="card-title">Select a User</h3>
                        <form id="recommendationForm">
                            <div class="mb-3">
                                <label for="userId" class="form-label">User ID</label>
                                <select class="form-select" id="userId" name="userId" required>
                                    <option value="" selected disabled>Select a user...</option>
                                    {% for user in users %}
                                    <option value="{{ user }}">User {{ user }}</option>
                                    {% endfor %}
                                </select>
                                <div class="form-text">Or enter any user ID manually:</div>
                                <input type="text" class="form-control mt-2" id="userIdCustom" placeholder="Enter user ID manually">
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Recommendation Algorithm</label>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="algorithm" id="algorithmBaseline" value="baseline" checked>
                                    <label class="form-check-label" for="algorithmBaseline">
                                        Global Baseline <span class="badge bg-success">Fastest</span>
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="algorithm" id="algorithmUserUser" value="user_user">
                                    <label class="form-check-label" for="algorithmUserUser">
                                        User-User CF
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="algorithm" id="algorithmItemItem" value="item_item">
                                    <label class="form-check-label" for="algorithmItemItem">
                                        Item-Item CF <span class="badge bg-primary">Most Accurate</span>
                                    </label>
                                </div>
                            </div>
                            <button type="submit" class="btn btn-primary w-100">Get Recommendations</button>
                        </form>
                    </div>
                </div>
            </div>
            <div class="col-lg-8">
                <div id="loadingRecommendations" class="text-center d-none">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                    <p class="mt-2">Generating recommendations...</p>
                </div>
                
                <div id="recommendationResults" class="d-none">
                    <div class="row mb-4">
                        <div class="col">
                            <h3>Top Recommendations for User <span id="selectedUserId"></span></h3>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="content-card">
                                <h4><i class="fas fa-thumbs-up me-2"></i>Recommended Movies</h4>
                                <div id="recommendedMoviesList" class="movie-list"></div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="content-card">
                                <h4><i class="fas fa-history me-2"></i>Previously Rated Movies</h4>
                                <div id="ratedMoviesList" class="movie-list"></div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div id="noRecommendations" class="text-center mt-5 d-none">
                    <div class="alert alert-warning">
                        <i class="fas fa-exclamation-triangle me-2"></i>
                        <span>No recommendations found for this user. Try another user or algorithm.</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer class="mt-5 py-4">
        <div class="container text-center">
            <p>© 2025 MovieLens Recommender System · Big Data Project</p>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        $(document).ready(function() {
            // Handle manually entered user IDs
            $('#userIdCustom').on('input', function() {
                if ($(this).val().trim() !== '') {
                    $('#userId').prop('disabled', true);
                } else {
                    $('#userId').prop('disabled', false);
                }
            });

            $('#userId').on('change', function() {
                $('#userIdCustom').val('');
            });

            // Handle form submission
            $('#recommendationForm').on('submit', function(e) {
                e.preventDefault();
                
                // Get user ID (either from dropdown or manual input)
                let userId = $('#userIdCustom').val().trim() !== '' ? 
                             $('#userIdCustom').val().trim() : 
                             $('#userId').val();
                
                if (!userId) {
                    alert('Please select or enter a user ID');
                    return;
                }
                
                // Get selected algorithm
                let algorithm = $('input[name="algorithm"]:checked').val();
                
                // Show loading spinner
                $('#recommendationResults').addClass('d-none');
                $('#noRecommendations').addClass('d-none');
                $('#loadingRecommendations').removeClass('d-none');
                
                // Send request to server
                $.ajax({
                    url: '/get_recommendations',
                    type: 'POST',
                    data: {
                        userId: userId,
                        algorithm: algorithm
                    },
                    success: function(response) {
                        // Hide loading spinner
                        $('#loadingRecommendations').addClass('d-none');
                        
                        if (response.error) {
                            $('#noRecommendations').removeClass('d-none');
                            return;
                        }
                        
                        // Display user ID
                        $('#selectedUserId').text(response.userId);
                        
                        // Display recommended movies
                        const recommendedMoviesList = $('#recommendedMoviesList');
                        recommendedMoviesList.empty();
                        
                        if (response.recommendedMovies.length === 0) {
                            recommendedMoviesList.append('<div class="alert alert-info">No recommendations available.</div>');
                        } else {
                            $.each(response.recommendedMovies, function(i, movie) {
                                recommendedMoviesList.append(`
                                    <div class="movie-item">
                                        <div class="movie-rating">${movie.predicted_rating}</div>
                                        <div class="movie-info">
                                            <h5 class="movie-title">${movie.title}</h5>
                                            <div class="movie-genres">${movie.genres}</div>
                                        </div>
                                    </div>
                                `);
                            });
                        }
                        
                        // Display rated movies
                        const ratedMoviesList = $('#ratedMoviesList');
                        ratedMoviesList.empty();
                        
                        if (response.ratedMovies.length === 0) {
                            ratedMoviesList.append('<div class="alert alert-info">No rated movies available.</div>');
                        } else {
                            $.each(response.ratedMovies, function(i, movie) {
                                ratedMoviesList.append(`
                                    <div class="movie-item">
                                        <div class="movie-rating">${movie.rating}</div>
                                        <div class="movie-info">
                                            <h5 class="movie-title">${movie.title}</h5>
                                            <div class="movie-genres">${movie.genres}</div>
                                        </div>
                                    </div>
                                `);
                            });
                        }
                        
                        // Show results
                        $('#recommendationResults').removeClass('d-none');
                    },
                    error: function() {
                        // Hide loading spinner
                        $('#loadingRecommendations').addClass('d-none');
                        $('#noRecommendations').removeClass('d-none');
                    }
                });
            });
        });
    </script>
</body>
</html>
